<div class="page-container">
  @if (loading()) {
    <div class="loading-center"><mat-spinner /></div>
  } @else {
    @switch (currentUser()?.role) {
      <!-- ── ARTIST ─────────────────────────────────── -->
      @case ('ROLE_ARTIST') {
        <app-page-header title="My Profile"></app-page-header>

        <mat-tab-group animationDuration="200ms">
          <mat-tab label="Profile">
            <div class="tab-body">
              <app-dynamic-form
                #artistProfileForm
                [formConfig]="artistProfileFields()"
              />
            </div>
            <button
              mat-flat-button
              color="primary"
              (click)="saveArtistProfile()"
            >
              Save Profile
            </button>
          </mat-tab>

          <mat-tab label="Works ({{ works().length }})">
            <div class="tab-body">
              <div class="section-action-row">
                <button
                  mat-flat-button
                  color="primary"
                  (click)="showWorkForm.set(!showWorkForm())"
                >
                  <mat-icon>add</mat-icon> Add Work
                </button>
              </div>

              @if (showWorkForm()) {
                <mat-card
                  appearance="outlined"
                  class="inline-form-card"
                >
                  <mat-card-content>
                    <app-dynamic-form
                      #workForm
                      [formConfig]="workFormFields()"
                    />
                  </mat-card-content>
                  <mat-card-actions>
                    <button
                      mat-flat-button
                      color="primary"
                      (click)="saveWork()"
                    >
                      Save
                    </button>
                    <button mat-button (click)="cancelWorkForm()">
                      Cancel
                    </button>
                  </mat-card-actions>
                </mat-card>
              }

              @if (works().length === 0) {
                <app-empty-state
                  icon="brush"
                  title="No works yet"
                  message="Add your first artwork to your portfolio"
                />
              } @else {
                @for (w of works(); track w.id) {
                  <app-work-card
                    [work]="w"
                    [editable]="true"
                    (editClicked)="startEditWork($event)"
                    (deleteClicked)="deleteWork($event)"
                  />
                }
              }
            </div>
          </mat-tab>

          <mat-tab label="Achievements ({{ achievements().length }})">
            <div class="tab-body">
              <div class="section-action-row">
                <button
                  mat-flat-button
                  color="primary"
                  (click)="
                    showAchievementForm.set(!showAchievementForm())
                  "
                >
                  <mat-icon>add</mat-icon> Add Achievement
                </button>
              </div>

              @if (showAchievementForm()) {
                <mat-card
                  appearance="outlined"
                  class="inline-form-card"
                >
                  <mat-card-content>
                    <app-dynamic-form
                      #achievementForm
                      [formConfig]="achievementFormFields()"
                    />
                  </mat-card-content>
                  <mat-card-actions>
                    <button
                      mat-flat-button
                      color="primary"
                      (click)="saveAchievement()"
                    >
                      Save
                    </button>
                    <button
                      mat-button
                      (click)="cancelAchievementForm()"
                    >
                      Cancel
                    </button>
                  </mat-card-actions>
                </mat-card>
              }

              @if (achievements().length === 0) {
                <app-empty-state
                  icon="emoji_events"
                  title="No achievements"
                  message="Add your awards, exhibitions and publications"
                />
              } @else {
                @for (a of achievements(); track a.id) {
                  <app-achievement-item
                    [achievement]="a"
                    [editable]="true"
                    (editClicked)="startEditAchievement($event)"
                    (deleteClicked)="deleteAchievement($event)"
                  />
                }
              }
            </div>
          </mat-tab>
        </mat-tab-group>
      }

      <!-- ── RESIDENCE ADMIN ────────────────────────── -->
      @case ('ROLE_RESIDENCE_ADMIN') {
        <app-page-header title="Residence Profile"> </app-page-header>

        @if (residenceProfile()) {
          <mat-card
            appearance="outlined"
            class="validation-banner"
            [class.approved]="
              residenceProfile()!.validation?.validationStatus ===
              'APPROVED'
            "
            [class.pending]="
              residenceProfile()!.validation?.validationStatus ===
              'PENDING'
            "
            [class.rejected]="
              residenceProfile()!.validation?.validationStatus ===
              'REJECTED'
            "
          >
            <mat-card-content class="banner-content">
              <mat-icon>verified</mat-icon>
              <span>
                Residence status:
                <strong>{{
                  residenceProfile()!.validation?.validationStatus
                }}</strong>
                @if (
                  residenceProfile()!.validation?.validationComment
                ) {
                  —
                  {{
                    residenceProfile()!.validation!.validationComment
                  }}
                }
              </span>
            </mat-card-content>
          </mat-card>
        }

        <div class="form-section">
          <app-dynamic-form
            #residenceProfileForm
            [formConfig]="residenceProfileFields()"
          />
          <button
            mat-flat-button
            color="primary"
            (click)="saveResidenceProfile()"
          >
            Save Profile
          </button>
        </div>

        @if (residenceProfile()?.validation?.validationComment) {
          <mat-card appearance="outlined" class="validation-note">
            <mat-card-content>
              <div class="validation-note__row">
                <mat-icon color="warn">info</mat-icon>
                <span>{{
                  residenceProfile()!.validation!.validationComment
                }}</span>
              </div>
            </mat-card-content>
          </mat-card>
        }
      }

      <!-- ── EXPERT ─────────────────────────────────── -->
      @case ('ROLE_EXPERT') {
        <app-page-header title="Expert Profile" />

        <mat-card appearance="outlined" class="expert-info-card">
          <mat-card-content>
            <div class="info-row">
              <span class="label">Name</span
              ><span
                >{{ currentUser()?.name }}
                {{ currentUser()?.surname }}</span
              >
            </div>
            <mat-divider />
            <div class="info-row">
              <span class="label">Email</span
              ><span>{{ currentUser()?.username }}</span>
            </div>
            <mat-divider />
            <div class="info-row">
              <span class="label">Role</span
              ><span>{{
                roleFormatter(currentUser()?.role ?? '')
              }}</span>
            </div>
          </mat-card-content>
        </mat-card>
      }

      <!-- ── SUPERADMIN ──────────────────────────────── -->
      @case ('ROLE_SUPERADMIN') {
        <app-page-header title="Administrator" />
        <mat-card appearance="outlined" class="expert-info-card">
          <mat-card-content>
            <div class="info-row">
              <span class="label">Username</span
              ><span>{{ currentUser()?.username }}</span>
            </div>
            <mat-divider />
            <div class="info-row">
              <span class="label">Role</span
              ><span>{{ roleFormatter('ROLE_SUPERADMIN') }}</span>
            </div>
          </mat-card-content>
        </mat-card>
      }
    }
  }
</div>
